<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>iris_classification_visualization02</title>
		<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
		<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@latest"></script>
	</head>
	<body>
		<script>
			let data_path = "https://fchart.github.io/test/iris.json";
			// 從 JSON 載入資料
			async function getData() {
				const irisDataReq = await fetch(data_path); // 發送請求獲取資料
				const irisData = await irisDataReq.json(); // 將回應解析為 JSON
				// 清理資料，只保留需要的欄位並過濾掉無效值
				const filterData = irisData
					.map((flower) => ({
						sLength: flower.sepalLength, // 花萼長度
						sWidth: flower.sepalWidth, // 花萼寬度
						species: flower.species, // 種類
						pLength: flower.petalLength, // 花瓣長度
						pWidth: flower.petalWidth, // 花瓣寬度
					}))
					.filter((flower) => flower.sLength != null && flower.sWidth != null && flower.species != null); // 過濾掉無效值
				return filterData;
			}

			// 視覺化資料
			async function visualization() {
				const data = await getData(); // 獲取資料
				// 根據種類過濾資料並轉換為散點圖格式
				const setosa = data.filter((d) => d.species == "setosa").map((d) => ({ x: d.sLength, y: d.sWidth }));
				const s_virginica = data.filter((d) => d.species == "virginica").map((d) => ({ x: d.sLength, y: d.sWidth }));
				const s_versicolor = data.filter((d) => d.species == "versicolor").map((d) => ({ x: d.sLength, y: d.sWidth }));

				// 繪製花萼長度 vs 花萼寬度的散點圖
				tfvis.render.scatterplot(
					{ name: "花萼長度 vs 花萼寬度" },
					{ values: [setosa, s_virginica, s_versicolor], series: ["setosa", "virginica", "versicolor"] },
					{ xLabel: "花萼長度", yLabel: "花萼寬度", height: 300 }
				);

				// 根據種類過濾資料並轉換為散點圖格式
				const d_virginica = data.filter((d) => d.species == "virginica").map((d) => ({ x: d.pLength, y: d.pWidth }));
				const d_versicolor = data.filter((d) => d.species == "versicolor").map((d) => ({ x: d.pLength, y: d.pWidth }));
				// 繪製花瓣長度 vs 花瓣寬度的散點圖
				tfvis.render.scatterplot(
					{ name: "花瓣長度 vs 花瓣寬度" }, // 圖表名稱
					{ values: [setosa, d_virginica, d_versicolor], series: ["setosa", "virginica", "versicolor"] }, // 資料和系列
					{ xLabel: "花瓣長度", yLabel: "花瓣寬度", height: 300 } // 軸標籤和圖表高度
				);
			}

			visualization();
		</script>
	</body>
</html>
